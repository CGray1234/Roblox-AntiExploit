local Players = game:GetService("Players")
local Player = Players.LocalPlayer

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RemoteEvents = ReplicatedStorage:WaitForChild("RemoteEvents")

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local _Workspace_ = game:GetService("Workspace")
repeat wait() until game:IsLoaded()

local WhitelistedGuis = {"ProximityPrompts", "Freecam", "Chat", "Freecom", "KCoreUI", "ChatInstallVerifier", "LoadingGui", "TouchGui", "TopbarPlus", "BubbleChat", "RbxCameraUI"}
local BannedItems = {"BodyGyro", "BodyPosition", "BodyForce", "BodyVelocity", "BodyAngularVelocity", "ModuleScript", "Folder"}
local BannedHumanoidStates = {6, 11, 14, 16}
local admins = {}

function isInTable(tableValue, toFind)
	local found = false
	for _,v in pairs(tableValue) do
		if v==toFind then
			found = true
			break;
		end
	end
	return found
end

function Disconnect(Message)
	pcall(function()
		ReplicatedStorage.ClientBanEvent.Ban:FireServer(Player)
		ReplicatedStorage.RemoteEvents.ClientKick:FireServer(Message)
		wait(0.01)
		Player:Kick("Our anti-cheat has detected that you were exploiting. Therefore, you have been banned. Source: Client Anti-Cheat")
	end)
end


coroutine.resume(coroutine.create(function()
	while wait(10) do
		pcall(function()
			for _, Child in pairs(Player.PlayerGui:GetChildren()) do
				if table.find(WhitelistedGuis, Child.Name) then return end
				if Child.Name == "Dex" then
					if isInTable(admins, Player.UserId) then
						return
					end
					Disconnect()
				end
			end
			
			if _Workspace_:GetRealPhysicsFPS() > 60 then
				if isInTable(admins, Player.UserId) then
					return
				end
				Disconnect(Player.Name.." was caught using Dex!")
			end
		end)
	end
end))

Player.Character:WaitForChild("Humanoid").StateChanged:Connect(function(PreviousState, CurrentState)
	if table.find(BannedHumanoidStates, CurrentState.Value) then
		if Player.Character.Humanoid.Health == 0 then
			return
		end
		if isInTable(admins, Player.UserId) then
			return
		end
		Disconnect(Player.Name.."'s FPS was higher than the limit. This player was not using FPS Unlocker, but another exploit.")
	end
end)

Player.Backpack.ChildAdded:Connect(function(Child)
	for _, v in pairs(Child:GetDescendants()) do
		if v.Name:lower():find("bt") then
			if isInTable(admins, Player.UserId) then
				return
			end
			Disconnect(Player.Name.."'s HumanoidState was changed from "..PreviousState.." to "..CurrentState..".")
		end
	end
end)

Player.PlayerGui.ChildAdded:Connect(function(Child)
	if not table.find(WhitelistedGuis, Child.Name) then
		if isInTable(admins, Player.UserId) then
			return
		end
		Disconnect(Player.Name.." inserted a "..Child.ClassName.." called: "..Child.Name)
	end
end)

while true do
	wait()
	if Player.Character:WaitForChild("Humanoid").WalkSpeed > 16 then --Replace 16 with whatever you want it to be, or delete the entire section
		if isInTable(admins, Player.UserId) then
			return
		end
		Disconnect(Player.Name.."'s WalkSpeed is above the limit!")
	end
end

Player.Character.DescendantAdded:Connect(function(Descendant)
	if table.find(BannedItems, Descendant.ClassName) then
		if isInTable(admins, Player.UserId) then
			return
		end
		
		Disconnect("A "..Descendant.ClassName.." called "..Descendant.Name.." was inserted into "..Player.Name.."'s character!")
	end
end)

